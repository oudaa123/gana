<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… ÙƒØ±Ø§Ø³Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - Ø§Ù„ÙƒØ§Ø´ÙŠØ±</title>
<style>
  :root {
    --accent:#6ed0ff;
    --btn:#ff9ad1;
    --done:#d8d8d8;
    --pending:#fff7a5;
    --warning:#ffcccc;
    --active:#4CAF50;
    --primary: #2196F3;
    --secondary: #FF9800;
    --success: #4CAF50;
    --danger: #f44336;
    --light: #f8f9fa;
    --dark: #343a40;
  }

  * {
    box-sizing: border-box;
  }

  body {
    font-family: Tahoma, Arial;
    background: linear-gradient(135deg, #e8f8ff 0%, #f0f8ff 100%);
    margin: 0;
    padding: 10px;
    color: #333;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
    padding: 20px;
  }

  h2 {
    text-align: center;
    margin-bottom: 5px;
    color: #004466;
    font-size: 28px;
  }

  #datetime {
    text-align: center;
    font-size: 14px;
    color: #333;
    margin-bottom: 5px;
  }

  #currentDateDisplay {
    text-align: center;
    font-size: 16px;
    font-weight: bold;
    color: #004466;
    margin-bottom: 10px;
    padding: 5px;
    background-color: #d8f0ff;
    border-radius: 5px;
  }

  #topBar {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }

  .cashier-section {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }

  .input-panel {
    background: #f8fdff;
    border-radius: 10px;
    padding: 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
  }

  .input-group {
    margin-bottom: 15px;
  }

  .input-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    color: #004466;
  }

  input, button, select {
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 16px;
    width: 100%;
  }

  input:focus, select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
  }

  button {
    background: var(--btn);
    color: #000;
    cursor: pointer;
    font-weight: bold;
    transition: 0.2s;
    border: none;
  }

  button:hover {
    background: #ff7ec5;
    transform: translateY(-2px);
  }

  .btn-primary {
    background: var(--primary);
    color: white;
  }

  .btn-success {
    background: var(--success);
    color: white;
  }

  .btn-danger {
    background: var(--danger);
    color: white;
  }

  .btn-secondary {
    background: var(--secondary);
    color: white;
  }

  .btn-group {
    display: flex;
    gap: 10px;
  }

  .btn-group button {
    flex: 1;
  }

  .quantity-controls {
    display: flex;
    gap: 5px;
    margin-top: 10px;
  }

  .quantity-controls button {
    flex: 0 0 50px;
  }

  .quantity-controls input {
    flex: 1;
    text-align: center;
  }

  .suggestions {
    position: absolute;
    background: white;
    border: 1px solid #ccc;
    border-radius: 5px;
    width: calc(100% - 24px);
    max-height: 200px;
    overflow-y: auto;
    z-index: 100;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  .suggestion-item {
    padding: 10px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
  }

  .suggestion-item:hover {
    background: #f0f8ff;
  }

  .suggestion-item:last-child {
    border-bottom: none;
  }

  .input-with-suggestions {
    position: relative;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }

  th, td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: center;
  }

  th {
    background: var(--accent);
    font-weight: bold;
  }

  tr.done td {
    text-decoration: line-through;
    color: red;
    background: var(--done);
  }

  tr.pending td {
    background: var(--pending);
  }

  .day-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-top: 10px;
    justify-content: center;
  }

  .day-buttons button {
    background: var(--accent);
    border: none;
    flex: 0 1 auto;
    width: auto;
    padding: 8px 15px;
  }

  .day-buttons button.active {
    background: var(--active);
    color: white;
    font-weight: bold;
  }

  .warning {
    background-color: var(--warning) !important;
  }

  .hidden {
    display: none;
  }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 10px;
    margin-top: 15px;
    max-height: 200px;
    overflow-y: auto;
    padding: 10px;
    border: 1px solid #eee;
    border-radius: 8px;
    background: #f9f9f9;
  }

  .product-item {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
  }

  .product-item:hover {
    background: #f0f8ff;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }

  .product-item.selected {
    background: var(--accent);
    border-color: var(--primary);
  }

  @media (max-width:600px){
    .cashier-section {
      grid-template-columns: 1fr;
    }
    
    .btn-group {
      flex-direction: column;
    }
    
    .product-grid {
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    }
  }
</style>
</head>
<body>

<div class="container">
  <h2>ğŸ§¾ Ù†Ø¸Ø§Ù… ÙƒØ±Ø§Ø³Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - Ø§Ù„ÙƒØ§Ø´ÙŠØ±</h2>
  <div id="datetime"></div>
  <div id="currentDateDisplay"></div>

  <div id="topBar">
    <button onclick="confirmDeleteAll()" class="btn-danger">ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    <button onclick="confirmDeleteWeek()" class="btn-secondary">ğŸ§¹ Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
    <button onclick="showProductManager()" class="btn-primary">ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
  </div>

  <div class="cashier-section">
    <div class="input-panel">
      <h3>Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
      
      <div class="input-group">
        <label for="person">Ø§Ù„Ø§Ø³Ù…</label>
        <input type="text" id="person" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
      </div>
      
      <div class="input-group">
        <label for="item">Ø§Ù„ØµÙ†Ù</label>
        <div class="input-with-suggestions">
          <input type="text" id="item" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯">
          <div id="itemSuggestions" class="suggestions hidden"></div>
        </div>
      </div>
      
      <div class="input-group">
        <label>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</label>
        <div class="product-grid" id="productGrid"></div>
      </div>
      
      <div class="input-group">
        <label for="qty">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
        <div class="quantity-controls">
          <button type="button" onclick="decreaseQuantity()">-</button>
          <input type="number" id="qty" value="1" min="1">
          <button type="button" onclick="increaseQuantity()">+</button>
        </div>
      </div>
      
      <div class="input-group">
        <label for="price">Ø§Ù„Ø³Ø¹Ø±</label>
        <input type="number" id="price" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
      </div>
      
      <div class="input-group">
        <label for="receiver">Ø§Ù„Ù…Ø³ØªÙ„Ù…</label>
        <input type="text" id="receiver" placeholder="Ø§Ù„Ù…Ø³ØªÙ„Ù… (ÙŠØªØ¹Ø¨Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)">
      </div>
      
      <div class="btn-group">
        <button id="addBtn" class="btn-success">â• Ø¥Ø¶Ø§ÙØ©</button>
      </div>
    </div>
  </div>

  <div class="day-buttons" id="dayButtons"></div>

  <table>
    <thead>
      <tr>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ø§Ù„ØµÙ†Ù</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø§Ù„Ø³Ø¹Ø±</th>
        <th>Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
<div id="productManager" class="hidden">
  <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000;">
    <div style="background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
      <h3>ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
      <div class="input-group">
        <label for="newProduct">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</label>
        <div style="display: flex; gap: 10px;">
          <input type="text" id="newProduct" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
          <button onclick="addNewProduct()" class="btn-success">Ø¥Ø¶Ø§ÙØ©</button>
        </div>
      </div>
      
      <h4>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
      <div id="productList" style="max-height: 300px; overflow-y: auto; margin-top: 10px;"></div>
      
      <div style="margin-top: 20px; text-align: center;">
        <button onclick="hideProductManager()" class="btn-primary">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>
</div>

<script>
// Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
let dailyRecords = JSON.parse(localStorage.getItem("dailyRecords") || "{}");
let currentDisplayDate = getTodayDate();
let lastKnownDate = getTodayDate();
let productList = JSON.parse(localStorage.getItem("productList") || "[]");

// ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙØ§Ø±ØºØ©
if (productList.length === 0) {
  productList = [
    "Ø¬Ø±Ø§Ø¨ Ø§Ù„Ù…Ø§Ø³", "Ø¬Ø±Ø§Ø¨ Ø§Ø³ÙƒØªØ´", "Ø¬Ø±Ø§Ø¨ Ø¯Ø¨ÙˆØ³", "Ø¬Ø±Ø§Ø¨ ÙƒÙŠØ§Ù‡ ÙˆØ´ ÙˆØ¸Ù‡Ø±", 
    "Ø¬Ø±Ø§Ø¨ Ø¬Ù„Ø¯ Ù…ØµØ±ÙŠ", "Ø¬Ø±Ø§Ø¨ ÙˆØ§ÙŠØ± Ù„ÙŠØ³ Ø¹Ø¯Ø³Ù‡", "Ø¬Ø±Ø§Ø¨ Ù‚Ø·ÙŠÙÙ‡", "Ø¬Ø±Ø§Ø¨ Ø³ÙŠÙ„ÙƒÙˆÙ† Ø¨Ø§Ø±Ø²", 
    "Ø¬Ø±Ø§Ø¨ 4k", "Ø¬Ø±Ø§Ø¨ Ø¨Ø§Ù…Ø¨ Ù…Ø±Ø¨Ø¹Ø§Øª", "Ø¬Ø±Ø§Ø¨ Ø¬Ù„Ø¯ Ø§Ù„Ùƒ", "Ø¬Ø±Ø§Ø¨ Ø¬Ù„Ø¯ Ø´Ø±ÙƒØ§Øª", 
    "Ø¬Ø±Ø§Ø¨ ØªØ§Ø¨ Ù…Ø¯Ø§Ø±Ø³", "Ø¬Ø±Ø§Ø¨ Ù„ÙŠØ²Ø±", "Ø¬Ø±Ø§Ø¨ Ø¨Ø§Ù…Ø¨ Ù…ØµØ±Ø¨", "Ø¬Ø±Ø§Ø¨ Ø¹Ø¯Ø³Ù‡ Ø§Ø´ÙƒØ§Ù„", 
    "Ø¬Ø±Ø§Ø¨ Ø¨Ø§Ù…Ø¨ Ø­Ø±ÙŠÙ…ÙŠ", "Ø¬Ø±Ø§Ø¨ Ù„ÙŠØ²Ø± ÙƒÙ„Ø§Ø³ÙŠÙƒ", "Ø§Ø³ÙƒØ±ÙŠÙ† Ø§Ù„ØªØ±Ø§", "Ø§Ø³ÙƒØ±ÙŠÙ† Ø§ØªØ´ Ø¯ÙŠ", 
    "Ø§Ø³ÙƒØ±ÙŠÙ† Ø§ÙˆØ¬ÙŠ Ø§Ùˆog", "Ø§Ø³ÙƒØ±ÙŠÙ†Ù‡ ØºØ²Ø§Ù„Ù‡", "Ø§Ø³ÙƒØ±ÙŠÙ†Ù‡ ÙØ§Ù…ÙŠÙ‡", "Ø§Ø³ÙƒØ±ÙŠÙ†Ù‡ ØªØ§Ø¨ Ù…Ø¯Ø§Ø±Ø³", 
    "ØµØ¨ Ù¦Ù¦Ù¨", "ØµØ¨ Ù¡Ù¡Ù¢", "ØµØ¨ Ù¡Ù¡Ù£", "ØµØ¨ Ù¡Ù¢Ù¢", "ØµØ¨Ù¡Ù¢Ù¥", "ØµØ¨ v16", 
    "ØµØ¨ d36", "ØµØ¨ jpal Ø§Ùˆ Ø±ÙŠÙ„Ù…ÙŠ ØµØºÙŠØ±", "ØµØ¨ Ù¢Ù£Ù Ù¤", "ØµØ¨ Ù¡Ù¨Ù¨Ù¡", "ØµØ¨ Ù¡Ù Ù¢Ù£", 
    "ØµØ¨ Ø¹Ø±Ø¨ÙŠÙ‡", "ØµØ¨ Ø¨Ø§Ø²ÙˆÙƒØ§ ÙØ±ÙˆØ§", "ØµØ¨ ÙØ±Ø¯Ù‡ ÙˆØ§Ø­Ø¯Ù‡", "ØµØ¨ Ø¨Ø§Ø²ÙˆÙƒØ§ ÙØ±Ø¹ÙˆÙ†ÙŠ", 
    "ØµØ¨ Ù¤ Ø¨ÙˆØµÙ‡", "ØµØ¨ Ù¥ Ø¨ÙˆØµÙ‡", "ØµØ¨ Ù¦ Ø¨ÙˆØµÙ‡"
  ];
  saveProductList();
}

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… Ø¨ØµÙŠØºØ© YYYY-MM-DD (Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø­Ù„ÙŠ)
function getTodayDate() {
  const now = new Date();
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const day = String(now.getDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
}

// ØªØ­ÙˆÙŠÙ„ ØªØ§Ø±ÙŠØ® Ù…Ù† ØµÙŠØºØ© YYYY-MM-DD Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø¹Ø±Ø¨ÙŠ
function formatArabicDate(dateString) {
  const date = new Date(dateString + 'T12:00:00');
  const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
  return date.toLocaleDateString('ar-EG', options);
}

// Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† ØªØ§Ø±ÙŠØ®ÙŠÙ† Ø¨Ø§Ù„Ø£ÙŠØ§Ù…
function getDaysDifference(date1, date2) {
  const oneDay = 24 * 60 * 60 * 1000;
  const firstDate = new Date(date1);
  const secondDate = new Date(date2);
  const diffDays = Math.round(Math.abs((firstDate - secondDate) / oneDay));
  return diffDays;
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØºÙŠÙŠØ± Ø§Ù„ÙŠÙˆÙ… ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
function checkDateChange() {
  const today = getTodayDate();
  
  // Ø¥Ø°Ø§ ØªØºÙŠØ± Ø§Ù„ÙŠÙˆÙ… ÙˆÙ†Ø­Ù† Ù†Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
  if (today !== lastKnownDate && currentDisplayDate === lastKnownDate) {
    console.log('ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„ÙŠÙˆÙ… Ù…Ù†', lastKnownDate, 'Ø¥Ù„Ù‰', today);
    lastKnownDate = today;
    currentDisplayDate = today; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    renderDayButtons();
    renderTable(today);
  }
}

// ğŸ•’ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø³Ø§Ø¹Ø© ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØºÙŠÙŠØ± Ø§Ù„ÙŠÙˆÙ…
function updateDateTime() {
  const now = new Date();
  const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
  const dateStr = now.toLocaleDateString('ar-EG', options);
  const timeStr = now.toLocaleTimeString('ar-EG');
  document.getElementById("datetime").textContent = `ğŸ•’ ${dateStr} - ${timeStr}`;
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØºÙŠÙŠØ± Ø§Ù„ÙŠÙˆÙ…
  checkDateChange();
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
  updateCurrentDateDisplay();
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
function updateCurrentDateDisplay() {
  const dateStr = formatArabicDate(currentDisplayDate);
  
  let displayText = `ğŸ“… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© Ù„ÙŠÙˆÙ…: ${dateStr}`;
  
  // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù„Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ù†Ø¹Ø±Ø¶ ÙŠÙˆÙ… Ø¢Ø®Ø±
  if (currentDisplayDate !== getTodayDate()) {
    displayText += ` <button onclick="showToday()" style="margin-right:10px; padding:3px 8px; font-size:12px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ</button>`;
  }
  
  document.getElementById("currentDateDisplay").innerHTML = displayText;
}

// Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨ ÙÙ‚Ø·)
function showToday() {
  currentDisplayDate = getTodayDate();
  updateCurrentDateDisplay();
  renderDayButtons();
  renderTable(currentDisplayDate);
}

setInterval(updateDateTime, 1000);
updateDateTime();

// Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙƒÙ…ÙŠØ©
function increaseQuantity() {
  const qtyInput = document.getElementById("qty");
  qtyInput.value = parseInt(qtyInput.value) + 1;
}

function decreaseQuantity() {
  const qtyInput = document.getElementById("qty");
  if (parseInt(qtyInput.value) > 1) {
    qtyInput.value = parseInt(qtyInput.value) - 1;
  }
}

// Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª
document.getElementById("item").addEventListener("input", function() {
  const query = this.value.trim();
  const suggestions = document.getElementById("itemSuggestions");
  
  if (query.length === 0) {
    suggestions.classList.add("hidden");
    return;
  }
  
  const filteredProducts = productList.filter(product => 
    product.toLowerCase().includes(query.toLowerCase())
  );
  
  suggestions.innerHTML = "";
  
  if (filteredProducts.length > 0) {
    filteredProducts.forEach(product => {
      const div = document.createElement("div");
      div.className = "suggestion-item";
      div.textContent = product;
      div.onclick = function() {
        document.getElementById("item").value = product;
        suggestions.classList.add("hidden");
        document.getElementById("price").focus();
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ­Ø¯ÙŠØ¯
        document.querySelectorAll(".product-item").forEach(item => {
          item.classList.remove("selected");
        });
      };
      suggestions.appendChild(div);
    });
    suggestions.classList.remove("hidden");
  } else {
    suggestions.classList.add("hidden");
  }
});

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
document.addEventListener("click", function(e) {
  if (!e.target.closest(".input-with-suggestions")) {
    document.getElementById("itemSuggestions").classList.add("hidden");
  }
});

// Ø¹Ø±Ø¶ Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function renderProductGrid() {
  const productGrid = document.getElementById("productGrid");
  productGrid.innerHTML = "";
  
  productList.forEach(product => {
    const productItem = document.createElement("div");
    productItem.className = "product-item";
    productItem.textContent = product;
    productItem.onclick = function() {
      document.getElementById("item").value = product;
      document.getElementById("price").focus();
      
      // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ­Ø¯ÙŠØ¯
      document.querySelectorAll(".product-item").forEach(item => {
        item.classList.remove("selected");
      });
      this.classList.add("selected");
    };
    productGrid.appendChild(productItem);
  });
}

// ğŸ§­ Ø¹Ø±Ø¶ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£ÙŠØ§Ù…
function renderDayButtons() {
  const dayButtons = document.getElementById("dayButtons");
  dayButtons.innerHTML = "";
  
  const today = getTodayDate();
  
  // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£ÙˆÙ„Ø§Ù‹
  const todayBtn = document.createElement("button");
  todayBtn.textContent = "Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ";
  todayBtn.onclick = () => {
    currentDisplayDate = today;
    renderTable(today);
    updateCurrentDateDisplay();
    renderDayButtons();
  };
  if (currentDisplayDate === today) {
    todayBtn.classList.add("active");
  }
  dayButtons.appendChild(todayBtn);
  
  // Ø¹Ø±Ø¶ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø®Ø±Ù‰
  Object.keys(dailyRecords)
    .sort()
    .reverse()
    .forEach(date => {
      if (date !== today) {
        const btn = document.createElement("button");
        const displayDate = formatArabicDate(date);
        btn.textContent = displayDate.split('ØŒ ')[1];
        btn.title = displayDate;
        
        btn.onclick = () => {
          currentDisplayDate = date;
          renderTable(date);
          updateCurrentDateDisplay();
          renderDayButtons();
        };
        
        if (date === currentDisplayDate) {
          btn.classList.add("active");
        }
        
        dayButtons.appendChild(btn);
      }
    });
}

// ğŸ“‹ Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯
function renderTable(date) {
  currentDisplayDate = date;
  const table = document.getElementById("tableBody");
  table.innerHTML = "";
  const records = dailyRecords[date] || [];
  
  if (records.length === 0) {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td colspan="7" style="text-align:center; padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</td>`;
    table.appendChild(tr);
  } else {
    records.forEach((r, i) => {
      const tr = document.createElement("tr");
      tr.classList.add(r.returned ? "done" : "pending");
      tr.innerHTML = `
        <td>${r.person}</td>
        <td>${r.item}</td>
        <td>${r.qty || ""}</td>
        <td>${r.price ? r.price + " Ø¬Ù†ÙŠÙ‡" : ""}</td>
        <td>${r.receiver}</td>
        <td>${r.returned ? "âœ… ØªÙ… Ø§Ù„Ø³Ø¯Ø§Ø¯" : "âŒ Ù„Ù… ÙŠØ³Ø¯Ø¯"}</td>
        <td>
          <button onclick="toggleReturn('${date}',${i})" class="${r.returned ? 'btn-secondary' : 'btn-success'}" style="padding: 5px 10px; font-size: 14px;">
            ${r.returned ? "ØªØ±Ø§Ø¬Ø¹" : "ØªÙ… Ø§Ù„Ø³Ø¯Ø§Ø¯"}
          </button>
          <button onclick="deleteRecord('${date}',${i})" class="btn-danger" style="padding: 5px 10px; font-size: 14px;">Ø­Ø°Ù</button>
        </td>
      `;
      table.appendChild(tr);
    });
  }
  
  updateCurrentDateDisplay();
}

// ğŸ” ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹
function toggleReturn(date, index) {
  const record = dailyRecords[date][index];
  if (!record.returned) {
    record.returned = true;
  } else {
    if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù† "${record.person}" Ù„Ù… ÙŠØ³Ø¯Ø¯ØŸ`)) {
      const pass = prompt("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:");
      if (pass === "888") record.returned = false;
      else return alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
    }
  }
  saveData();
  renderTable(currentDisplayDate);
}

// Ø­Ø°Ù Ø³Ø¬Ù„ (ÙŠØªØ·Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø³Ø±)
function deleteRecord(date, index) {
  const pass = prompt("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ø­Ø°Ù:");
  if (pass !== "888") {
    return alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
  }
  
  if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ")) {
    dailyRecords[date].splice(index, 1);
    if (dailyRecords[date].length === 0) {
      delete dailyRecords[date];
    }
    saveData();
    renderTable(currentDisplayDate);
  }
}

// ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function saveData() {
  localStorage.setItem("dailyRecords", JSON.stringify(dailyRecords));
  renderDayButtons();
}

// Ø­ÙØ¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function saveProductList() {
  localStorage.setItem("productList", JSON.stringify(productList));
  renderProductGrid();
}

// â• Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
document.getElementById("addBtn").onclick = () => {
  const person = document.getElementById("person").value.trim();
  const item = document.getElementById("item").value.trim();
  const qty = document.getElementById("qty").value.trim();
  const price = document.getElementById("price").value.trim();
  let receiver = document.getElementById("receiver").value.trim();

  if (!person || !item) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµÙ†Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
  if (!receiver) receiver = person;

  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
  if (!productList.includes(item)) {
    productList.push(item);
    saveProductList();
  }

  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙŠÙˆÙ… Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¯Ø§Ø¦Ù…Ø§Ù‹
  const today = getTodayDate();
  if (!dailyRecords[today]) dailyRecords[today] = [];
  dailyRecords[today].push({ person, item, qty, price, receiver, returned: false });
  saveData();
  
  // Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ù†Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠØŒ Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
  if (currentDisplayDate === today) {
    renderTable(today);
  } else {
    // Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ù†Ø¹Ø±Ø¶ ÙŠÙˆÙ… Ø¢Ø®Ø±ØŒ Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙ‚Ø·
    renderDayButtons();
  }
  
  // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
  document.getElementById("person").value = "";
  document.getElementById("item").value = "";
  document.getElementById("qty").value = "1";
  document.getElementById("price").value = "";
  document.getElementById("receiver").value = "";
  
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  document.querySelectorAll(".product-item").forEach(item => {
    item.classList.remove("selected");
  });
  
  document.getElementById("person").focus();
};

// ğŸ§¹ Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¨Ø¨Ø§Ø³ÙˆØ±Ø¯
function confirmDeleteWeek() {
  if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù‚Ø¯Ù… Ù…Ù† 7 Ø£ÙŠØ§Ù….")) {
    const pass = prompt("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:");
    if (pass === "888") {
      const today = getTodayDate();
      let deletedCount = 0;
      
      const dates = Object.keys(dailyRecords);
      
      dates.forEach(date => {
        const daysDifference = getDaysDifference(today, date);
        if (daysDifference > 7) {
          delete dailyRecords[date];
          deletedCount++;
        }
      });
      
      saveData();
      
      if (deletedCount > 0) {
        alert(`ØªÙ… Ø­Ø°Ù ${deletedCount} ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…`);
      } else {
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ù‚Ø¯Ù… Ù…Ù† 7 Ø£ÙŠØ§Ù… Ù„Ø­Ø°ÙÙ‡Ø§");
      }
      
      renderTable(currentDisplayDate);
    } else {
      alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
    }
  }
}

// ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function confirmDeleteAll() {
  if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
    const hasPending = Object.values(dailyRecords).some(records => 
      records.some(record => !record.returned)
    );
    
    if (hasPending) {
      const confirmDelete = confirm("âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ù†Ø§Ùƒ Ø£Ø´Ø®Ø§Øµ Ù„Ù… ÙŠØ³Ø¯Ø¯ÙˆØ§ Ø¨Ø¹Ø¯. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ");
      if (!confirmDelete) return;
    }
    
    const pass = prompt("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:");
    if (pass === "888") {
      dailyRecords = {};
      saveData();
      alert("ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…");
      renderTable(currentDisplayDate);
    } else {
      alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
    }
  }
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function showProductManager() {
  document.getElementById("productManager").classList.remove("hidden");
  renderProductList();
}

function hideProductManager() {
  document.getElementById("productManager").classList.add("hidden");
}

function renderProductList() {
  const productListElement = document.getElementById("productList");
  productListElement.innerHTML = "";
  
  if (productList.length === 0) {
    productListElement.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¶Ø§ÙØ©</p>";
    return;
  }
  
  productList.forEach((product, index) => {
    const productItem = document.createElement("div");
    productItem.style.display = "flex";
    productItem.style.justifyContent = "space-between";
    productItem.style.alignItems = "center";
    productItem.style.padding = "8px";
    productItem.style.borderBottom = "1px solid #eee";
    
    productItem.innerHTML = `
      <span>${product}</span>
      <button onclick="removeProduct(${index})" class="btn-danger" style="padding: 5px 10px; font-size: 12px;">Ø­Ø°Ù</button>
    `;
    
    productListElement.appendChild(productItem);
  });
}

function addNewProduct() {
  const newProductInput = document.getElementById("newProduct");
  const productName = newProductInput.value.trim();
  
  if (!productName) {
    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬");
    return;
  }
  
  if (productList.includes(productName)) {
    alert("Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„");
    return;
  }
  
  productList.push(productName);
  saveProductList();
  newProductInput.value = "";
  renderProductList();
  renderProductGrid();
}

function removeProduct(index) {
  if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù "${productList[index]}"ØŸ`)) {
    productList.splice(index, 1);
    saveProductList();
    renderProductList();
    renderProductGrid();
  }
}

// ğŸŸ¢ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
renderDayButtons();
renderTable(currentDisplayDate);
renderProductGrid();
</script>

</body>
</html>
